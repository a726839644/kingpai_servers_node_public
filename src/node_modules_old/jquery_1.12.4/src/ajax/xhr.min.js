define(["../core","../var/document","../var/support","../ajax"],function(f,b,d){f.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){if(this.isLocal){return g()}if(b.documentMode>8){return a()}return/^(get|post|head|put|delete|options)$/i.test(this.type)&&a()||g()}:a;var e=0,c={},h=f.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var i in c){c[i](undefined,true)}})}d.cors=!!h&&("withCredentials" in h);h=d.ajax=!!h;if(h){f.ajaxTransport(function(i){if(!i.crossDomain||d.cors){var j;return{send:function(n,k){var l,m=i.xhr(),o=++e;m.open(i.type,i.url,i.async,i.username,i.password);if(i.xhrFields){for(l in i.xhrFields){m[l]=i.xhrFields[l]}}if(i.mimeType&&m.overrideMimeType){m.overrideMimeType(i.mimeType)}if(!i.crossDomain&&!n["X-Requested-With"]){n["X-Requested-With"]="XMLHttpRequest"}for(l in n){if(n[l]!==undefined){m.setRequestHeader(l,n[l]+"")}}m.send((i.hasContent&&i.data)||null);j=function(r,q){var p,u,s;if(j&&(q||m.readyState===4)){delete c[o];j=undefined;m.onreadystatechange=f.noop;if(q){if(m.readyState!==4){m.abort()}}else{s={};p=m.status;if(typeof m.responseText==="string"){s.text=m.responseText}try{u=m.statusText}catch(t){u=""}if(!p&&i.isLocal&&!i.crossDomain){p=s.text?200:404}else{if(p===1223){p=204}}}}if(s){k(p,u,s,m.getAllResponseHeaders())}};if(!i.async){j()}else{if(m.readyState===4){window.setTimeout(j)}else{m.onreadystatechange=c[o]=j}}},abort:function(){if(j){j(undefined,true)}}}}})}function a(){try{return new window.XMLHttpRequest()}catch(i){}}function g(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(i){}}});