$(function(h){var b=h("#cards");var e=b.find(".card");var g=h(".input-content");var n=h(".submit-input");var f=!!window.ActiveXObject||"ActiveXObject" in window;if(f){h(".card .card-box > div").css({transitionDuration:"1ms"})}for(var j=0;j<11;j++){b.append(e.clone());var l=g.clone();l.find("label").html("卡片"+(j+2)).prop({"for":"card"+(j+2)});l.find("input").prop({id:"card"+(j+2)});n.parent().before(l)}e=b.find(".card");var c=h(".input-text");var p=h(".shuffle");var q=e.length;var a=false;var o=false;var d=(function d(){var i;var r=document.createElement("fakeelement");var s={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionsend",WebkitTransition:"webkitTransitionEnd"};for(i in s){if(r.style[i]!==undefined){return s[i]}}})();function k(s,i,r){if(d){h(i).one(d,function(){s(r)})}else{s(r)}}function m(u){var r=[];while(r.length<u-1){var t=Math.floor(Math.random()*u);if(h.inArray(t,r)==-1){r.push(t)}}for(var s=0;;s++){if(h.inArray(s,r)==-1){r.push(s);break}}return r}c.each(function(r){h(this).val(localStorage["card"+r])});h(".dropdown-menu").on("click",function(i){i.stopPropagation()});n.on("click",function(){if(confirm("确认提交新内容？")){c.each(function(r){localStorage["card"+r]=h(this).val()});p.trigger("click");return false}else{return false}});b.on("click",function(t){if(!o){var i=h(t.target).parent();if(i.prop("class").indexOf("back")!=-1){i.parent().parent().addClass("open");if(a===false){i.parent().parent().addClass("first");a=e.index(i.parent().parent());var s=m(q);var r=h(".content-box");r.each(function(v){var w=localStorage["card"+s[v]];if(w===undefined){w="请输入内容"}if(w[0]!=="<"){w="<p class='card-content'>"+w+"</p>"}else{var u=w.indexOf(">");w=w.substr(0,u)+" class='card-content'"+w.substr(u)}w="<span></span>"+w;h(this).html(w)})}}}});b.on("dblclick",function(i){if(h(i.target).prop("class").indexOf("card-content")!=-1||h(i.target).parent().parent().parent().prop("class").indexOf("open")!=-1){e.each(function(){h(this).addClass("open")});if(a===false){a=0}}});p.on("click",function(){if(!o){o=true;var i=0,u=h(window).height()-h(e).height()*1.2;var t=[],s=[];e.each(function(v){t[v]=i-h(this).offset().left;s[v]=u-h(this).offset().top});(function r(){var w=m(q);if(a!==false){e.each(function(){h(this).removeClass("open first")});k(v,e[a],0)}else{v(0)}a=false;function v(y){setTimeout(function(){h(e[y]).css("transform","translate("+t[y]+"px,"+s[y]+"px)");h(e[y]).addClass("card-shuffle");if(y<q-1){v(++y)}else{k(function(){setTimeout(function(){x(0)},50)},e[q-1])}},100)}function x(y){setTimeout(function(){h(e[w[y]]).css("transform","");h(e[y]).removeClass("card-shuffle");if(y<q-1){x(++y)}else{k(function(){o=false},e[w[q-1]])}},100)}})()}})}(jQuery));