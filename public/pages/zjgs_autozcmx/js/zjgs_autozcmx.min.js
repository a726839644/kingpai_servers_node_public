+function(c){var e=c("#upload_excel");var d=c("#filename");var b=c("#upload_form");var a=c("#select_statement");var g=c("#view_code");e.on("change",f);function f(){var j=e.val();d.html(j.substring(j.lastIndexOf("\\")+1));c.ajax({url:"/parse_xlsx",type:"post",dataType:"json",data:new FormData(b[0]),async:false,cache:false,contentType:false,processData:false,success:function(k){if(k.length==0){alert("报表格式错误或无内容");a.html("");g.html("")}else{i(k)}},error:function(l,k,m){console.error(m)}});return false}function h(m,k,j){var l=c("<option>");l.prop({value:k});l.html(m);j.append(l)}function i(m){var n={};var j={};for(var l=0;l<m.length;l++){n[m[l].name]=m[l].data}a.html("");for(var k in n){if(n.hasOwnProperty(k)){h(k,k,a);j[k]=o(n[k])}}a.on("change",function(){g.html(j[a.val()])});a.trigger("change");function o(t){var u="";var q=[];for(var s=1;s<t.length;s++){var w={};var v=t[s];if(v[3]==null){continue}w.zj_fphm=v[3];w.zj_jqsbmc=v[9];var r=p(v[8]);if(r.getFullYear()<2012){u="请确认excel开票日期格式是否为日期格式。row = "+s;break}else{w.zj_gmrq=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()}w.zj_sbdj=v[4];w.zj_sbsl=1;w.zj_sbje=v[4];w.zj_dkse=v[5];q.push(w)}return"+function(){var c="+JSON.stringify(q)+';var a=0;var i=[];setTimeout(function(){b()},0);function b(){if(a>0){zj_add()}if(a<c.length){a++;h(c[a-1],b)}else{if(i.length>0){alert("请检测"+i.toString()+"列的日期是否错误")}}}function h(g,e){var k;var j;var t;var l;var d;var s;var f;k=u("zj_fphm");j=u("zj_jqsbmc");t=u("zj_gmrq");l=u("zj_sbdj");d=u("zj_sbsl");s=u("zj_sbje");f=u("zj_dkse");k.value=g.zj_fphm;j.value=g.zj_jqsbmc;t.value=g.zj_gmrq;l.value=g.zj_sbdj;d.value=g.zj_sbsl;s.value=g.zj_sbje;f.value=g.zj_dkse;k.setAttribute("data-input","yes");j.setAttribute("data-input","yes");t.setAttribute("data-input","yes");l.setAttribute("data-input","yes");d.setAttribute("data-input","yes");s.setAttribute("data-input","yes");f.setAttribute("data-input","yes");if(g.zj_gmrq.indexOf("NaN")!=-1){i.push(a)}f.onchange();setTimeout(function(){e()},0);function u(o){var m=document.getElementsByName(o);for(var n=0;n<m.length;n++){if(m[n].getAttribute("data-input")!="yes"){return m[n]}}}}}();';function p(x){return new Date(new Date(1900,0,0).getTime()-1+x*24*60*60*1000)}}}}(jQuery);